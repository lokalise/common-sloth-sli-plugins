
---
# Code generated by Sloth (v0.11.0): https://github.com/slok/sloth.
# DO NOT EDIT.

apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  creationTimestamp: null
  labels:
    app.kubernetes.io/component: SLO
    app.kubernetes.io/managed-by: sloth
    release: prometheus-stack
  name: example
  namespace: monitoring
spec:
  groups:
  - name: sloth-slo-sli-recordings-example-http-error-rate
    rules:
    - expr: "(\n(\n\t(\n\t\tsum(\n\t\t\trate(http_request_duration_seconds_count{
        route=~\"/v1/workspaces/.*\", service=~\"autopilot-backend-workspace-service\",
        status_code=~\"(5..|429)\"}[5m])\n\t\t)\n\t\t/\n\t\t(sum(\n\t\t\trate(http_request_duration_seconds_count{
        route=~\"/v1/workspaces/.*\", service=~\"autopilot-backend-workspace-service\"}[5m])\n\t\t)
        > 0)\n\t) AND on(service) sum(rate(http_request_duration_seconds_count{ service=~\"autopilot-backend-workspace-service\"}[5m]))
        > 10\n) OR on() vector(0)\n)"
      labels:
        owner: platform
        sloth_id: example-http-error-rate
        sloth_service: example
        sloth_slo: http-error-rate
        sloth_window: 5m
      record: slo:sli_error:ratio_rate5m
    - expr: "(\n(\n\t(\n\t\tsum(\n\t\t\trate(http_request_duration_seconds_count{
        route=~\"/v1/workspaces/.*\", service=~\"autopilot-backend-workspace-service\",
        status_code=~\"(5..|429)\"}[30m])\n\t\t)\n\t\t/\n\t\t(sum(\n\t\t\trate(http_request_duration_seconds_count{
        route=~\"/v1/workspaces/.*\", service=~\"autopilot-backend-workspace-service\"}[30m])\n\t\t)
        > 0)\n\t) AND on(service) sum(rate(http_request_duration_seconds_count{ service=~\"autopilot-backend-workspace-service\"}[30m]))
        > 10\n) OR on() vector(0)\n)"
      labels:
        owner: platform
        sloth_id: example-http-error-rate
        sloth_service: example
        sloth_slo: http-error-rate
        sloth_window: 30m
      record: slo:sli_error:ratio_rate30m
    - expr: "(\n(\n\t(\n\t\tsum(\n\t\t\trate(http_request_duration_seconds_count{
        route=~\"/v1/workspaces/.*\", service=~\"autopilot-backend-workspace-service\",
        status_code=~\"(5..|429)\"}[1h])\n\t\t)\n\t\t/\n\t\t(sum(\n\t\t\trate(http_request_duration_seconds_count{
        route=~\"/v1/workspaces/.*\", service=~\"autopilot-backend-workspace-service\"}[1h])\n\t\t)
        > 0)\n\t) AND on(service) sum(rate(http_request_duration_seconds_count{ service=~\"autopilot-backend-workspace-service\"}[1h]))
        > 10\n) OR on() vector(0)\n)"
      labels:
        owner: platform
        sloth_id: example-http-error-rate
        sloth_service: example
        sloth_slo: http-error-rate
        sloth_window: 1h
      record: slo:sli_error:ratio_rate1h
    - expr: "(\n(\n\t(\n\t\tsum(\n\t\t\trate(http_request_duration_seconds_count{
        route=~\"/v1/workspaces/.*\", service=~\"autopilot-backend-workspace-service\",
        status_code=~\"(5..|429)\"}[2h])\n\t\t)\n\t\t/\n\t\t(sum(\n\t\t\trate(http_request_duration_seconds_count{
        route=~\"/v1/workspaces/.*\", service=~\"autopilot-backend-workspace-service\"}[2h])\n\t\t)
        > 0)\n\t) AND on(service) sum(rate(http_request_duration_seconds_count{ service=~\"autopilot-backend-workspace-service\"}[2h]))
        > 10\n) OR on() vector(0)\n)"
      labels:
        owner: platform
        sloth_id: example-http-error-rate
        sloth_service: example
        sloth_slo: http-error-rate
        sloth_window: 2h
      record: slo:sli_error:ratio_rate2h
    - expr: "(\n(\n\t(\n\t\tsum(\n\t\t\trate(http_request_duration_seconds_count{
        route=~\"/v1/workspaces/.*\", service=~\"autopilot-backend-workspace-service\",
        status_code=~\"(5..|429)\"}[6h])\n\t\t)\n\t\t/\n\t\t(sum(\n\t\t\trate(http_request_duration_seconds_count{
        route=~\"/v1/workspaces/.*\", service=~\"autopilot-backend-workspace-service\"}[6h])\n\t\t)
        > 0)\n\t) AND on(service) sum(rate(http_request_duration_seconds_count{ service=~\"autopilot-backend-workspace-service\"}[6h]))
        > 10\n) OR on() vector(0)\n)"
      labels:
        owner: platform
        sloth_id: example-http-error-rate
        sloth_service: example
        sloth_slo: http-error-rate
        sloth_window: 6h
      record: slo:sli_error:ratio_rate6h
    - expr: "(\n(\n\t(\n\t\tsum(\n\t\t\trate(http_request_duration_seconds_count{
        route=~\"/v1/workspaces/.*\", service=~\"autopilot-backend-workspace-service\",
        status_code=~\"(5..|429)\"}[1d])\n\t\t)\n\t\t/\n\t\t(sum(\n\t\t\trate(http_request_duration_seconds_count{
        route=~\"/v1/workspaces/.*\", service=~\"autopilot-backend-workspace-service\"}[1d])\n\t\t)
        > 0)\n\t) AND on(service) sum(rate(http_request_duration_seconds_count{ service=~\"autopilot-backend-workspace-service\"}[1d]))
        > 10\n) OR on() vector(0)\n)"
      labels:
        owner: platform
        sloth_id: example-http-error-rate
        sloth_service: example
        sloth_slo: http-error-rate
        sloth_window: 1d
      record: slo:sli_error:ratio_rate1d
    - expr: "(\n(\n\t(\n\t\tsum(\n\t\t\trate(http_request_duration_seconds_count{
        route=~\"/v1/workspaces/.*\", service=~\"autopilot-backend-workspace-service\",
        status_code=~\"(5..|429)\"}[3d])\n\t\t)\n\t\t/\n\t\t(sum(\n\t\t\trate(http_request_duration_seconds_count{
        route=~\"/v1/workspaces/.*\", service=~\"autopilot-backend-workspace-service\"}[3d])\n\t\t)
        > 0)\n\t) AND on(service) sum(rate(http_request_duration_seconds_count{ service=~\"autopilot-backend-workspace-service\"}[3d]))
        > 10\n) OR on() vector(0)\n)"
      labels:
        owner: platform
        sloth_id: example-http-error-rate
        sloth_service: example
        sloth_slo: http-error-rate
        sloth_window: 3d
      record: slo:sli_error:ratio_rate3d
    - expr: |
        sum_over_time(slo:sli_error:ratio_rate5m{sloth_id="example-http-error-rate", sloth_service="example", sloth_slo="http-error-rate"}[30d])
        / ignoring (sloth_window)
        count_over_time(slo:sli_error:ratio_rate5m{sloth_id="example-http-error-rate", sloth_service="example", sloth_slo="http-error-rate"}[30d])
      labels:
        owner: platform
        sloth_id: example-http-error-rate
        sloth_service: example
        sloth_slo: http-error-rate
        sloth_window: 30d
      record: slo:sli_error:ratio_rate30d
  - name: sloth-slo-meta-recordings-example-http-error-rate
    rules:
    - expr: vector(0.9998999999999999)
      labels:
        owner: platform
        sloth_id: example-http-error-rate
        sloth_service: example
        sloth_slo: http-error-rate
      record: slo:objective:ratio
    - expr: vector(1-0.9998999999999999)
      labels:
        owner: platform
        sloth_id: example-http-error-rate
        sloth_service: example
        sloth_slo: http-error-rate
      record: slo:error_budget:ratio
    - expr: vector(30)
      labels:
        owner: platform
        sloth_id: example-http-error-rate
        sloth_service: example
        sloth_slo: http-error-rate
      record: slo:time_period:days
    - expr: |
        slo:sli_error:ratio_rate5m{sloth_id="example-http-error-rate", sloth_service="example", sloth_slo="http-error-rate"}
        / on(sloth_id, sloth_slo, sloth_service) group_left
        slo:error_budget:ratio{sloth_id="example-http-error-rate", sloth_service="example", sloth_slo="http-error-rate"}
      labels:
        owner: platform
        sloth_id: example-http-error-rate
        sloth_service: example
        sloth_slo: http-error-rate
      record: slo:current_burn_rate:ratio
    - expr: |
        slo:sli_error:ratio_rate30d{sloth_id="example-http-error-rate", sloth_service="example", sloth_slo="http-error-rate"}
        / on(sloth_id, sloth_slo, sloth_service) group_left
        slo:error_budget:ratio{sloth_id="example-http-error-rate", sloth_service="example", sloth_slo="http-error-rate"}
      labels:
        owner: platform
        sloth_id: example-http-error-rate
        sloth_service: example
        sloth_slo: http-error-rate
      record: slo:period_burn_rate:ratio
    - expr: 1 - slo:period_burn_rate:ratio{sloth_id="example-http-error-rate", sloth_service="example",
        sloth_slo="http-error-rate"}
      labels:
        owner: platform
        sloth_id: example-http-error-rate
        sloth_service: example
        sloth_slo: http-error-rate
      record: slo:period_error_budget_remaining:ratio
    - expr: vector(1)
      labels:
        owner: platform
        sloth_id: example-http-error-rate
        sloth_mode: cli-gen-k8s
        sloth_objective: "99.99"
        sloth_service: example
        sloth_slo: http-error-rate
        sloth_spec: sloth.slok.dev/v1
        sloth_version: v0.11.0
      record: sloth_slo_info
  - name: sloth-slo-alerts-example-http-error-rate
    rules:
    - alert: HighErrorRate
      annotations:
        summary: '{{$labels.sloth_service}} {{$labels.sloth_slo}} SLO error budget
          burn rate is over expected.'
        title: (page) {{$labels.sloth_service}} {{$labels.sloth_slo}} SLO error budget
          burn rate is too fast.
      expr: |
        (
            max(slo:sli_error:ratio_rate5m{sloth_id="example-http-error-rate", sloth_service="example", sloth_slo="http-error-rate"} > (14.4 * 0.00010000000000005117)) without (sloth_window)
            and
            max(slo:sli_error:ratio_rate1h{sloth_id="example-http-error-rate", sloth_service="example", sloth_slo="http-error-rate"} > (14.4 * 0.00010000000000005117)) without (sloth_window)
        )
        or
        (
            max(slo:sli_error:ratio_rate30m{sloth_id="example-http-error-rate", sloth_service="example", sloth_slo="http-error-rate"} > (6 * 0.00010000000000005117)) without (sloth_window)
            and
            max(slo:sli_error:ratio_rate6h{sloth_id="example-http-error-rate", sloth_service="example", sloth_slo="http-error-rate"} > (6 * 0.00010000000000005117)) without (sloth_window)
        )
      labels:
        runbookurl: todo
        sloth_severity: page
  - name: sloth-slo-sli-recordings-example-http-latency
    rules:
    - expr: "(\n\t1 - ((\n\t\t(\n\t\t\tsum(\n\t\t\t\trate(http_request_duration_seconds_bucket{
        route=~\"/v1/projects/.*\", service=~\"autopilot-backend-import-service\",
        le=\"5\" }[5m])\n\t\t\t)\n\t\t\t/\n\t\t\t(sum(\n\t\t\t\trate(http_request_duration_seconds_bucket{
        route=~\"/v1/projects/.*\", service=~\"autopilot-backend-import-service\"
        }[5m])\n\t\t\t) > 0)\n\t\t) AND on(service) sum(rate(http_request_duration_seconds_bucket{
        service=~\"autopilot-backend-import-service\" }[5m])) > 10\n) OR on() vector(1))\n)"
      labels:
        owner: platform
        sloth_id: example-http-latency
        sloth_service: example
        sloth_slo: http-latency
        sloth_window: 5m
      record: slo:sli_error:ratio_rate5m
    - expr: "(\n\t1 - ((\n\t\t(\n\t\t\tsum(\n\t\t\t\trate(http_request_duration_seconds_bucket{
        route=~\"/v1/projects/.*\", service=~\"autopilot-backend-import-service\",
        le=\"5\" }[30m])\n\t\t\t)\n\t\t\t/\n\t\t\t(sum(\n\t\t\t\trate(http_request_duration_seconds_bucket{
        route=~\"/v1/projects/.*\", service=~\"autopilot-backend-import-service\"
        }[30m])\n\t\t\t) > 0)\n\t\t) AND on(service) sum(rate(http_request_duration_seconds_bucket{
        service=~\"autopilot-backend-import-service\" }[30m])) > 10\n) OR on() vector(1))\n)"
      labels:
        owner: platform
        sloth_id: example-http-latency
        sloth_service: example
        sloth_slo: http-latency
        sloth_window: 30m
      record: slo:sli_error:ratio_rate30m
    - expr: "(\n\t1 - ((\n\t\t(\n\t\t\tsum(\n\t\t\t\trate(http_request_duration_seconds_bucket{
        route=~\"/v1/projects/.*\", service=~\"autopilot-backend-import-service\",
        le=\"5\" }[1h])\n\t\t\t)\n\t\t\t/\n\t\t\t(sum(\n\t\t\t\trate(http_request_duration_seconds_bucket{
        route=~\"/v1/projects/.*\", service=~\"autopilot-backend-import-service\"
        }[1h])\n\t\t\t) > 0)\n\t\t) AND on(service) sum(rate(http_request_duration_seconds_bucket{
        service=~\"autopilot-backend-import-service\" }[1h])) > 10\n) OR on() vector(1))\n)"
      labels:
        owner: platform
        sloth_id: example-http-latency
        sloth_service: example
        sloth_slo: http-latency
        sloth_window: 1h
      record: slo:sli_error:ratio_rate1h
    - expr: "(\n\t1 - ((\n\t\t(\n\t\t\tsum(\n\t\t\t\trate(http_request_duration_seconds_bucket{
        route=~\"/v1/projects/.*\", service=~\"autopilot-backend-import-service\",
        le=\"5\" }[2h])\n\t\t\t)\n\t\t\t/\n\t\t\t(sum(\n\t\t\t\trate(http_request_duration_seconds_bucket{
        route=~\"/v1/projects/.*\", service=~\"autopilot-backend-import-service\"
        }[2h])\n\t\t\t) > 0)\n\t\t) AND on(service) sum(rate(http_request_duration_seconds_bucket{
        service=~\"autopilot-backend-import-service\" }[2h])) > 10\n) OR on() vector(1))\n)"
      labels:
        owner: platform
        sloth_id: example-http-latency
        sloth_service: example
        sloth_slo: http-latency
        sloth_window: 2h
      record: slo:sli_error:ratio_rate2h
    - expr: "(\n\t1 - ((\n\t\t(\n\t\t\tsum(\n\t\t\t\trate(http_request_duration_seconds_bucket{
        route=~\"/v1/projects/.*\", service=~\"autopilot-backend-import-service\",
        le=\"5\" }[6h])\n\t\t\t)\n\t\t\t/\n\t\t\t(sum(\n\t\t\t\trate(http_request_duration_seconds_bucket{
        route=~\"/v1/projects/.*\", service=~\"autopilot-backend-import-service\"
        }[6h])\n\t\t\t) > 0)\n\t\t) AND on(service) sum(rate(http_request_duration_seconds_bucket{
        service=~\"autopilot-backend-import-service\" }[6h])) > 10\n) OR on() vector(1))\n)"
      labels:
        owner: platform
        sloth_id: example-http-latency
        sloth_service: example
        sloth_slo: http-latency
        sloth_window: 6h
      record: slo:sli_error:ratio_rate6h
    - expr: "(\n\t1 - ((\n\t\t(\n\t\t\tsum(\n\t\t\t\trate(http_request_duration_seconds_bucket{
        route=~\"/v1/projects/.*\", service=~\"autopilot-backend-import-service\",
        le=\"5\" }[1d])\n\t\t\t)\n\t\t\t/\n\t\t\t(sum(\n\t\t\t\trate(http_request_duration_seconds_bucket{
        route=~\"/v1/projects/.*\", service=~\"autopilot-backend-import-service\"
        }[1d])\n\t\t\t) > 0)\n\t\t) AND on(service) sum(rate(http_request_duration_seconds_bucket{
        service=~\"autopilot-backend-import-service\" }[1d])) > 10\n) OR on() vector(1))\n)"
      labels:
        owner: platform
        sloth_id: example-http-latency
        sloth_service: example
        sloth_slo: http-latency
        sloth_window: 1d
      record: slo:sli_error:ratio_rate1d
    - expr: "(\n\t1 - ((\n\t\t(\n\t\t\tsum(\n\t\t\t\trate(http_request_duration_seconds_bucket{
        route=~\"/v1/projects/.*\", service=~\"autopilot-backend-import-service\",
        le=\"5\" }[3d])\n\t\t\t)\n\t\t\t/\n\t\t\t(sum(\n\t\t\t\trate(http_request_duration_seconds_bucket{
        route=~\"/v1/projects/.*\", service=~\"autopilot-backend-import-service\"
        }[3d])\n\t\t\t) > 0)\n\t\t) AND on(service) sum(rate(http_request_duration_seconds_bucket{
        service=~\"autopilot-backend-import-service\" }[3d])) > 10\n) OR on() vector(1))\n)"
      labels:
        owner: platform
        sloth_id: example-http-latency
        sloth_service: example
        sloth_slo: http-latency
        sloth_window: 3d
      record: slo:sli_error:ratio_rate3d
    - expr: |
        sum_over_time(slo:sli_error:ratio_rate5m{sloth_id="example-http-latency", sloth_service="example", sloth_slo="http-latency"}[30d])
        / ignoring (sloth_window)
        count_over_time(slo:sli_error:ratio_rate5m{sloth_id="example-http-latency", sloth_service="example", sloth_slo="http-latency"}[30d])
      labels:
        owner: platform
        sloth_id: example-http-latency
        sloth_service: example
        sloth_slo: http-latency
        sloth_window: 30d
      record: slo:sli_error:ratio_rate30d
  - name: sloth-slo-meta-recordings-example-http-latency
    rules:
    - expr: vector(0.9998999999999999)
      labels:
        owner: platform
        sloth_id: example-http-latency
        sloth_service: example
        sloth_slo: http-latency
      record: slo:objective:ratio
    - expr: vector(1-0.9998999999999999)
      labels:
        owner: platform
        sloth_id: example-http-latency
        sloth_service: example
        sloth_slo: http-latency
      record: slo:error_budget:ratio
    - expr: vector(30)
      labels:
        owner: platform
        sloth_id: example-http-latency
        sloth_service: example
        sloth_slo: http-latency
      record: slo:time_period:days
    - expr: |
        slo:sli_error:ratio_rate5m{sloth_id="example-http-latency", sloth_service="example", sloth_slo="http-latency"}
        / on(sloth_id, sloth_slo, sloth_service) group_left
        slo:error_budget:ratio{sloth_id="example-http-latency", sloth_service="example", sloth_slo="http-latency"}
      labels:
        owner: platform
        sloth_id: example-http-latency
        sloth_service: example
        sloth_slo: http-latency
      record: slo:current_burn_rate:ratio
    - expr: |
        slo:sli_error:ratio_rate30d{sloth_id="example-http-latency", sloth_service="example", sloth_slo="http-latency"}
        / on(sloth_id, sloth_slo, sloth_service) group_left
        slo:error_budget:ratio{sloth_id="example-http-latency", sloth_service="example", sloth_slo="http-latency"}
      labels:
        owner: platform
        sloth_id: example-http-latency
        sloth_service: example
        sloth_slo: http-latency
      record: slo:period_burn_rate:ratio
    - expr: 1 - slo:period_burn_rate:ratio{sloth_id="example-http-latency", sloth_service="example",
        sloth_slo="http-latency"}
      labels:
        owner: platform
        sloth_id: example-http-latency
        sloth_service: example
        sloth_slo: http-latency
      record: slo:period_error_budget_remaining:ratio
    - expr: vector(1)
      labels:
        owner: platform
        sloth_id: example-http-latency
        sloth_mode: cli-gen-k8s
        sloth_objective: "99.99"
        sloth_service: example
        sloth_slo: http-latency
        sloth_spec: sloth.slok.dev/v1
        sloth_version: v0.11.0
      record: sloth_slo_info
  - name: sloth-slo-alerts-example-http-latency
    rules:
    - alert: HighLatency
      annotations:
        summary: '{{$labels.sloth_service}} {{$labels.sloth_slo}} SLO error budget
          burn rate is over expected.'
        title: (page) {{$labels.sloth_service}} {{$labels.sloth_slo}} SLO error budget
          burn rate is too fast.
      expr: |
        (
            max(slo:sli_error:ratio_rate5m{sloth_id="example-http-latency", sloth_service="example", sloth_slo="http-latency"} > (14.4 * 0.00010000000000005117)) without (sloth_window)
            and
            max(slo:sli_error:ratio_rate1h{sloth_id="example-http-latency", sloth_service="example", sloth_slo="http-latency"} > (14.4 * 0.00010000000000005117)) without (sloth_window)
        )
        or
        (
            max(slo:sli_error:ratio_rate30m{sloth_id="example-http-latency", sloth_service="example", sloth_slo="http-latency"} > (6 * 0.00010000000000005117)) without (sloth_window)
            and
            max(slo:sli_error:ratio_rate6h{sloth_id="example-http-latency", sloth_service="example", sloth_slo="http-latency"} > (6 * 0.00010000000000005117)) without (sloth_window)
        )
      labels:
        runbookurl: todo
        sloth_severity: page
